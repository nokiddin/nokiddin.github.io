<!DOCTYPE html>
<!-- adapted from url=http://mdaines.github.io/viz.js/form.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>dot -&gt; svg</title>
    <style>
      
    #input {
      width: 500px;
      height: 300px;
    }

	#divinput {
		display: none;
	}
      
    </style>
  <style type="text/css"></style></head>
  <body>
	<div id="divinput"> 
    <p><textarea id="input">digraph G {

}
	</textarea></p>
    <a href="sample-simple.html">Simple sample</a>    
    <a href="sample-process.html">Process Sample</a>
    <p><button id="generate">Generate</button></p>
	</div>
    
    <div id="output"></div>
    <div id="inspect"></div>
    
    <script src="http://nokiddin.github.io/viz.js"></script>
    <!-- <script src="viz.js"></script> -->
    <script>
	function wrapasdigraph(x){
		return  "digraph G {\n" + x + "\n}";
	}
	function urldecode(s){
		return decodeURI(s);
	}
	function readfragment(s){
		if(!s) return {};
		if(s.charAt(0)!="#") return {};

		s = decodeURI(s);
		var frgtypendx=s.indexOf(":");
		if(frgtypendx < 0) return {};

		var frgtype=s.substring(1,frgtypendx);
		var frgdata=s.substr(frgtypendx+1);
		
		if(frgtype=='d'){
			return {data:wrapasdigraph(frgdata), flag:"grf"};
		}else if(frgtype=="db"){
			return {data:wrapasdigraph(frgdata), flag:"grf,dbg"};
		}else if(frgtype=="de"){
			return {data:wrapasdigraph(frgdata), flag:"grf,src,dbg"};
		}

	}
	function generate_svg(sdot){
		var engine="dot"; //"neato"
		var svg=Viz(sdot, "svg", engine); 
		return result = { svg: svg } ;
	}
	function onload_(){
		var input=readfragment(window.location.hash);
		if(input && input.data){
			
			var bshowsrc, bshowgrf;
			bshowgrf = (input.flag && (","+input.flag+",").match(/,grf,/));
			bshowsrc = (input.flag && (","+input.flag+",").match(/,src,/));
			bshowdbg = (input.flag && (","+input.flag+",").match(/,dbg,/));

			el("divinput").style.display=bshowsrc?"inherit":"none";
			displayresults(generate_svg(input.data).svg, bshowgrf, bshowdbg);
		}else{
			el("divinput").style.display="inherit";
		}
	}
	window.onload=onload_;
	
    function inspect(s) {
      return "<pre>" + s.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\"/g, "&quot;") + "</pre>";
    }

	function el(id){
		return document.getElementById(id);
	}
	function render(id, text, visible){
		el(id).innerHTML = text; //is set even for display:none case, for any programmatic dom access. 
		el(id).style.display=visible?"inherit":"none";
	}
	function displayresults(svg, showgrf, showdbg){
		render("output", svg, showgrf);
		render("inspect", inspect(svg), showdbg);
	}
      
    el("generate").addEventListener("click", function(e) {
      var result = generate_svg(el("input").value);
      
      if (result && result.svg) {
		displayresults(result.svg, true);
      } else {
        displayresults("", true);
      }
      
    });
      
    </script>
    
  
</body></html>
